{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Itemopia Page</h1>

    <h3 class="text-center">Halo, {{ name }}</h3>

    <div class="text-center">
        <h5>Ada <span id="jumlah_produk">{{ jumlah_produk }}</span> jenis item di tempat penyimpananmu saat ini</h5>
        <h5>Total keseluruhan itemmu ada: <span id="jumlah_item">{{ jumlah_item }}</span></h5>
    </div>

    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>Name</th>
                <th>Amount</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.name }}</td>
                <td>
                    <span id="amount_{{ product.id }}">{{ product.amount }}</span>
                    <button class="btn btn-primary btn-sm btn-increment" data-product-id="{{ product.id }}" data-increment="1">+</button>
                    <button class="btn btn-primary btn-sm btn-decrement" data-product-id="{{ product.id }}" data-increment="-1">-</button>
                </td>
                <td>{{ product.description }}</td>
                <td>
                    <form method="post" action="{% url 'main:hapus_produk' product.id %}">
                        {% csrf_token %}
                        <button class="btn btn-danger btn-sm" type="submit">Hapus</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="text-center mt-4">
        <a href="{% url 'main:create_product' %}" class="btn btn-success btn-lg">Add New Product</a>
        <a href="{% url 'main:logout' %}" class="btn btn-secondary btn-lg">Logout</a>
    </div>

    <div class="text-center mt-4">
        <h5>Sesi terakhir login: {{ last_login }}</h5>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Mengambil semua tombol penambahan
        const incrementButtons = document.querySelectorAll('.btn-increment');
        // Mengambil semua tombol pengurangan
        const decrementButtons = document.querySelectorAll('.btn-decrement');

        // Menambahkan event listener untuk setiap tombol penambahan
        incrementButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Mengambil ID produk dari atribut data
                const productId = this.getAttribute('data-product-id');
                // Mengambil nilai penambahan dari atribut data
                const incrementValue = parseInt(this.getAttribute('data-increment'));
                // Mengambil elemen jumlah produk berdasarkan ID produk
                const amountElement = document.getElementById(`amount_${productId}`);
                // Mengambil nilai jumlah produk saat ini
                const currentAmount = parseInt(amountElement.innerText);
                // Menghitung jumlah produk yang baru
                const newAmount = currentAmount + incrementValue;

                // Mengubah teks pada elemen jumlah produk dengan nilai yang baru
                amountElement.innerText = newAmount;

                // (Anda bisa menambahkan logika tambahan di sini jika diperlukan)
            });
        });

        // Menambahkan event listener untuk setiap tombol pengurangan
        decrementButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Mengambil ID produk dari atribut data
                const productId = this.getAttribute('data-product-id');
                // Mengambil nilai penambahan dari atribut data
                const incrementValue = parseInt(this.getAttribute('data-increment'));
                // Mengambil elemen jumlah produk berdasarkan ID produk
                const amountElement = document.getElementById(`amount_${productId}`);
                // Mengambil nilai jumlah produk saat ini
                const currentAmount = parseInt(amountElement.innerText);
                // Menghitung jumlah produk yang baru
                const newAmount = currentAmount + incrementValue;

                // Mengubah teks pada elemen jumlah produk dengan nilai yang baru
                amountElement.innerText = newAmount;

                // (Anda bisa menambahkan logika tambahan di sini jika diperlukan)
            });
        });
    });
</script>
{% endblock content %}
